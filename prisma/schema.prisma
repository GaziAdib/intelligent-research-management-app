generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(auto()) @map("_id") @db.ObjectId
  profileImageUrl   String
  coverPhotoUrl     String?
  username          String
  email             String    @unique
  password          String
  phone1            String?
  phone2            String?
  present_address   String?
  permanent_address String?
  facebook          String?
  youtube           String?
  twitter           String?
  linkedIn          String?
  instagram         String?
  role              Role      @default(USER)
  bio               String?
  permissions       String[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  teams Team[]
  tasks Task[]
  taskLeaderMergedContents TaskLeaderMergedContent[]
  taskReferences TaskReference[]
  teamMembers    TeamMember[]
  messageSenders  Message[] @relation("Sender")
  // messageReceipts MessageReceipt[]
  conversation Conversation[]
}

model Team {
  id                   String   @id @default(auto()) @map("_id") @db.ObjectId
  leaderId             String   @db.ObjectId
  leader               User?    @relation(fields: [leaderId], references: [id])
  teamName             String
  teamShortDescription String
  teamBgColor          String?
  teamTextColor        String?
  teamLogoUrl          String?
  tasks                Task[]
  notifications        Notification[]
  teamMembers          TeamMember[]
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  conversation         Conversation?
}

model TeamMember {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  teamId       String   @db.ObjectId
  team         Team?    @relation(fields: [teamId], references: [id])
  userId       String   @db.ObjectId
  user         User?    @relation(fields: [userId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Conversation {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  teamId    String   @db.ObjectId @unique
  team      Team?     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  title     String  // Optional: You can give conversation a title
  creatorId String?   @db.ObjectId
  creator   User?     @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  messages  Message[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Message {
  id             String         @id @default(auto()) @map("_id") @db.ObjectId
  conversationId String         @db.ObjectId
  conversation   Conversation   @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  senderId       String         @db.ObjectId
  sender         User?          @relation("Sender", fields: [senderId], references: [id])
  content        String
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  receivers      String[]       @db.ObjectId
  // receivers      MessageReceipt[] 
}

// model MessageReceipt {
//   id         String    @id @default(auto()) @map("_id") @db.ObjectId
//   messageId  String    @db.ObjectId
//   message    Message   @relation(fields: [messageId], references: [id], onDelete: Cascade)
//   receiverId String    @db.ObjectId
//   receiver   User      @relation(fields: [receiverId], references: [id]) // Can be TeamMember if you want
//   seen       Boolean   @default(false)
//   seenAt     DateTime?
// }



model Task {
  id                          String   @id @default(auto()) @map("_id") @db.ObjectId
  leaderId                    String   @db.ObjectId
  teamId                      String   @db.ObjectId
  team                        Team?    @relation(fields: [teamId], references: [id])
  taskTitle                   String
  taskShortDescription        String
  taskMemberDraftContent      String?
  remarkByLeader              String?
  aiGeneratedText             String?
  aiGeneratedCode             String?
  taskMemberFinalContent      String?
  taskRelatedReferences       TaskReference[] // Array of references (PDFs, images, etc.)
  priority                    TaskPriority @default(MEDIUM)
  status                      TaskStatus   @default(Draft)
  taskAssignedBy              User?        @relation(fields: [leaderId], references: [id])
  taskBgColor                 String?
  taskTextColor               String?
  taskAssignedTo              String[] @db.ObjectId
  notifications               Notification[]
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}



model TaskLeaderMergedContent {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  leaderId       String   @db.ObjectId
  leader         User?    @relation(fields: [leaderId], references: [id])
  mergedContent  String   // Final content merged by the leader
  createdAt      DateTime @default(now())
}


model TaskReference {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  taskId        String   @db.ObjectId   // Reference to the Task
  task          Task     @relation(fields: [taskId], references: [id])
  mediaType     ReferenceType // Type of the reference (PDF, Image, etc.)
  mediaUrls     String[]  // Array of media URLs
  userId        String   @db.ObjectId
  publicIds     String[] 
  uploadedBy    User?    @relation(fields: [userId], references: [id])
  createdAt     DateTime @default(now()) 
}


model Notification {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  recipientIds  String[] @db.ObjectId  // List of users who will receive this notification
  recipientEmails String[] 
  taskId        String?  @db.ObjectId
  task          Task?    @relation(fields: [taskId], references: [id])
  teamId        String?  @db.ObjectId
  team          Team?    @relation(fields: [teamId], references: [id])  // Reference to the team related to the task
  message       String 
  type          NotificationType // Enum (TASK_APPROVED, TASK_REJECTED, TASK_ASSIGNED)
  seenUsers     String[] @db.ObjectId @default([])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}



enum ReferenceType {
  PDF
  IMAGE
}

enum Role {
  ADMIN
  LEADER
  MEMBER
  USER
}

enum TaskStatus {
  Pending
  Approved
  Rejected
  Draft
}


enum TaskPriority {
 HIGH
 MEDIUM
 LOW
}


enum NotificationType {
  TASK_APPROVED
  TASK_REJECTED
  TASK_ASSIGNED
}